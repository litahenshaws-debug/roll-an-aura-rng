<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roll an Aura</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: 'Verdana', sans-serif;
            text-align: center;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
            user-select: none;
        }

        h1 {
            font-family: 'Comic Sans MS', cursive;
            text-shadow: 4px 4px 0px #ff00ff;
            font-size: 3rem;
            margin-bottom: 10px;
        }

        /* Status Area */
        #status-area {
            margin: 10px auto 20px;
            max-width: 600px;
            padding: 10px;
            border: 2px solid #555;
            border-radius: 8px;
            background: #282828;
            display: flex;
            justify-content: space-around;
            font-size: 1.1rem;
        }

        .luck-boost {
            color: #ffcc00;
            font-weight: bold;
        }

        .x10-boost {
            color: #00ffff;
        }

        .x100-boost {
            color: #ff00ff;
        }

        /* The Main Display Area */
        #display-area {
            border: 4px solid white;
            border-radius: 15px;
            background: #333;
            height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            max-width: 600px;
            transition: all 0.2s;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #aura-name {
            font-size: 2.5rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        #aura-rarity {
            font-size: 1.2rem;
            margin-top: 10px;
            font-style: italic;
        }

        /* Rolling Buttons */
        .btn {
            border: none;
            padding: 20px 50px;
            font-size: 2rem;
            color: white;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            font-family: 'Impact', sans-serif;
            margin: 5px;
        }

        #roll-btn {
            background: linear-gradient(45deg, #ff0000, #ff8800);
            box-shadow: 0 8px 0 #880000;
        }

        #roll-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #880000;
        }

        #auto-roll-btn {
            background: linear-gradient(45deg, #00ffff, #0088ff);
            box-shadow: 0 8px 0 #0055aa;
            color: black;
        }

        #auto-roll-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #0055aa;
        }

        #roll-btn:disabled,
        #auto-roll-btn:disabled {
            background: gray !important;
            box-shadow: 0 8px 0 #333 !important;
            cursor: not-allowed !important;
        }
        
        /* --- TAB UI STYLES --- */
        #tabs-container {
            max-width: 800px;
            margin: 30px auto 10px;
            border-bottom: 2px solid #555;
            display: flex;
            justify-content: center;
        }

        .tab-button {
            background: #444;
            color: white;
            border: 2px solid #555;
            border-bottom: none;
            padding: 10px 20px;
            margin: 0 2px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px 8px 0 0;
            transition: background 0.1s;
        }

        .tab-button:hover {
            background: #555;
        }

        .tab-button.active {
            background: #333;
            color: #ffcc00;
            border-color: #ffcc00;
            border-bottom: 2px solid #333; /* Hides the bottom border of the tab container */
        }
        
        .tab-content {
            background: #333;
            border: 2px solid #555;
            border-radius: 0 0 10px 10px;
            padding: 20px 10px;
            max-width: 800px;
            margin: 0 auto;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Luck Shop Content Styles */
        .boost-btn {
            box-shadow: 0 8px 0;
            font-size: 1.2rem;
            padding: 15px 25px;
            color: black;
            margin: 10px;
            display: inline-block;
            line-height: 1.2;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .boost-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0;
        }

        #boost-5x {
            background: linear-gradient(45deg, #ffcc00, #ffa300);
            box-shadow: 0 8px 0 #cc8800;
        }

        #boost-10x {
            background: linear-gradient(45deg, #00ffff, #00ff88);
            box-shadow: 0 8px 0 #008855;
        }

        #boost-100x {
            background: linear-gradient(45deg, #ff00ff, #aa00ff);
            box-shadow: 0 8px 0 #880088;
        }

        .disabled-boost {
            background: gray !important;
            box-shadow: 0 8px 0 #333 !important;
            cursor: not-allowed !important;
        }

        .active-boost {
            background: #ff4500 !important;
            box-shadow: 0 8px 0 #992a00 !important;
            color: white !important;
        }
        
        /* Shop & Rebirth Styles */
        #speed-shop h2, #luck-shop h2, #rebirth-shop h2 {
            margin-top: 0;
            color: #ffcc00;
            border-bottom: 1px solid #555;
            padding-bottom: 10px;
        }

        .upgrade-btn {
            background: linear-gradient(45deg, #0088ff, #0044aa);
            box-shadow: 0 6px 0 #002255;
            color: white;
            font-size: 1.1rem;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.1s;
            line-height: 1.2;
        }

        .upgrade-btn:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #002255;
        }

        .upgrade-btn:disabled {
            background: gray !important;
            box-shadow: 0 6px 0 #333 !important;
            cursor: not-allowed !important;
        }

        .purchased-upgrade {
            background: linear-gradient(45deg, #00cc00, #009900) !important;
            box-shadow: 0 6px 0 #005500 !important;
            cursor: not-allowed !important;
        }

        #rebirth-btn {
            background: linear-gradient(45deg, #ff4500, #cc0000);
            box-shadow: 0 8px 0 #992a00;
            color: white;
            font-size: 1.5rem;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s;
            margin-top: 10px;
        }

        #rebirth-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #992a00;
        }

        #rebirth-btn:disabled {
            background: #555 !important;
            box-shadow: 0 8px 0 #333 !important;
            cursor: not-allowed !important;
        }
        
        /* --- RARITY COLORS --- */
        .common {
            color: #ffffff;
            text-shadow: 0 0 5px #ffffff;
        }

        .uncommon {
            color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }

        .rare {
            color: #0088ff;
            text-shadow: 0 0 10px #0088ff;
        }

        .epic {
            color: #aa00ff;
            text-shadow: 0 0 15px #aa00ff;
        }

        .legendary {
            color: #ffaa00;
            text-shadow: 0 0 20px #ffaa00;
            animation: shake 0.5s infinite;
        }

        .mythical {
            background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
            -webkit-background-clip: text;
            color: transparent;
            font-size: 3rem !important;
            animation: rainbow-spin 2s linear infinite;
        }

        .divine {
            color: #ff00aa;
            text-shadow: 0 0 25px #ff00aa;
            animation: pulse 1.5s infinite alternate;
        }

        .cosmic {
            color: #9933ff;
            text-shadow: 0 0 30px #9933ff, 0 0 50px #9933ff;
            font-size: 3.5rem !important;
            animation: cosmic-wave 3s linear infinite;
        }

        /* Checklist Styles */
        .checklist {
            margin-top: 40px;
            border-top: 2px dashed #555;
            padding-top: 20px;
        }

        #uncollected-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-width: 800px;
            margin: 10px auto;
            font-size: 0.9rem;
        }

        .uncollected-item {
            background: #222;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px dashed #555;
            opacity: 0.5;
            text-decoration: line-through;
        }

        .collected-item {
            opacity: 1 !important;
            border: 1px solid #ffcc00 !important;
            text-decoration: none !important;
        }

        .inventory {
            margin-top: 40px;
            border-top: 2px dashed #555;
            padding-top: 20px;
        }

        .item-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .inv-item {
            background: #222;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #555;
            width: 120px;
            font-size: 0.8rem;
        }

        /* Sell Button Style */
        #sell-all-btn {
            background: linear-gradient(45deg, #00aa00, #00cc00);
            box-shadow: 0 5px 0 #006600;
            font-size: 1rem;
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.1s;
            margin-bottom: 10px;
        }

        #sell-all-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #006600;
        }

        #reset-btn {
            margin-top: 30px;
            padding: 10px 20px;
            background: #cc0000;
            box-shadow: 0 5px 0 #770000;
            font-size: 1rem;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        #reset-btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 #770000;
        }
    </style>
</head>

<body>

    <audio id="bg-music" loop>
        <source src="YOUR_BGM_FILE_URL_HERE" type="audio/mp3">
    </audio>
    <audio id="throttle-preventer" loop muted>
        <source src="YOUR_BGM_FILE_URL_HERE" type="audio/mp3">
    </audio>

    <h1>‚≠ê Roll an Aura ‚≠ê</h1>
    <p>Total Auras: 20 (v2.5). Limited-Time Aura Rotation Added!</p>

    <div id="status-area">
        <div>Current Luck: <span id="luck-display" class="luck-boost">1x</span></div>
        <div>üí∞ Coins: <span id="money-display" style="color: gold; font-weight: bold;">0</span></div>
        <div>‚ö° Power: <span id="power-display" style="color: red; font-weight: bold;">0</span></div>
        <div>Collected: <span id="collected-count">0/20</span></div>
    </div>

    <div id="display-area">
        <div id="aura-name">???</div>
        <div id="aura-rarity">Click button to steal</div>
    </div>
    
    <div id="limited-aura-status" style="margin: 20px auto; padding: 15px; border: 2px solid #9933ff; border-radius: 10px; background: #222; max-width: 600px;">
        <div id="limited-aura-display" style="font-size: 1.2rem; color: white;">
            Checking for Limited-Time Aura...
        </div>
    </div>
    <button id="roll-btn" class="btn" onclick="rollAura(false)">STEAL!</button>
    <button id="auto-roll-btn" class="btn" onclick="toggleAutoRoll()">AUTO ROLL</button>
    
    <div id="tabs-container">
        <button class="tab-button" onclick="openTab('luck-shop', this)" id="luck-tab">üí∞ Luck Boosts</button>
        <button class="tab-button" onclick="openTab('speed-shop', this)" id="speed-tab">‚ö° Speed Shop</button>
        <button class="tab-button" onclick="openTab('rebirth-shop', this)" id="rebirth-tab">üî• Rebirth</button>
    </div>

    <div id="tab-content-container">
        
        <div id="luck-shop" class="tab-content active">
            <h2>üí∞ Luck Boosts (Temporary)</h2>
            <div id="boost-buttons">
                <button id="boost-5x" class="boost-btn" onclick="activateBoost(5)">5X LUCK<br>(Cost: üí∞1,000)</button>
                <button id="boost-10x" class="boost-btn" onclick="activateBoost(10)">10X LUCK<br>(Cost: üí∞5,000)</button>
                <button id="boost-100x" class="boost-btn" onclick="activateBoost(100)">100X LUCK<br>(Cost: üí∞50,000)</button>
            </div>
        </div>

        <div id="speed-shop" class="tab-content">
            <h2>‚ö° AUTO ROLL SPEED SHOP <span id="speed-level-display">(Level 0)</span></h2>
            <div id="speed-upgrades">
                </div>
        </div>
        
        <div id="rebirth-shop" class="tab-content">
            <h2>üî• REBIRTH üî•</h2>
            <p>Current Income Multiplier: <span id="income-mult-display" style="color: lime; font-weight: bold;">1.0x</span></p>
            <p id="rebirth-cost-display">Reach üí∞1,000,000 to Rebirth.</p>
            <button id="rebirth-btn" onclick="doRebirth()" disabled>REBIRTH NOW</button>
        </div>
        
    </div>
    <div class="checklist">
        <h2>üìã AURA CHECKLIST</h2>
        <div id="uncollected-list">
            </div>
    </div>

    <div class="inventory">
        <h2>üéí STOLEN COLLECTION (Latest First)</h2>
        <button id="sell-all-btn" onclick="sellAllItems()">SELL ALL ITEMS</button>
        <div class="item-list" id="inventory-list">
            </div>
    </div>

    <button id="reset-btn" onclick="resetGame()">üö® RESET GAME DATA üö®</button>

    <script>
        // Define currency and storage key globally
        let money = 0;
        let autoRollSpeed = 1000;
        let speedLevel = 0;
        let power = 0;
        let powerMultiplier = 1;
        const BASE_REBIRTH_COST = 1000000;
        const POWER_BONUS = 2;

        // Storage keys updated for v2.5
        const MONEY_STORAGE_KEY = 'aura_money_v2_5';
        const SPEED_STORAGE_KEY = 'aura_speed_v2_5';
        const POWER_STORAGE_KEY = 'aura_power_v2_5';
        const COLLECTION_STORAGE_KEY = 'aura_collection_v2_5';
        const INVENTORY_STORAGE_KEY = 'aura_inventory_v2_5';

        // --- CORE AURA LIST ---
        const auras = [
            { name: "NPC Energy", rarity: "Common", chance: 2, class: "common", value: 50 },
            { name: "Low Taper Fade", rarity: "Common", chance: 3, class: "common", value: 60 },
            { name: "Just a Chill Guy", rarity: "Uncommon", chance: 5, class: "uncommon", value: 75 },
            { name: "Bombastic Side Eye", rarity: "Uncommon", chance: 8, class: "uncommon", value: 100 },
            { name: "Grimace Shake", rarity: "Rare", chance: 15, class: "rare", value: 150 },
            { name: "Skibidi Toilet", rarity: "Rare", chance: 25, class: "rare", value: 250 },
            { name: "Gen Z Slang Master", rarity: "Rare", chance: 30, class: "rare", value: 300 },
            { name: "Fanum Tax", rarity: "Epic", chance: 50, class: "epic", value: 500 },
            { name: "6-7 BRAIN ROT", rarity: "Epic", chance: 80, class: "epic", value: 800 },
            { name: "Ohio Final Boss", rarity: "Epic", chance: 80, class: "epic", value: 900 },
            { name: "Rizz God", rarity: "Epic", chance: 100, class: "epic", value: 1200 },
            { name: "SIGMA GIGACHAD", rarity: "LEGENDARY", chance: 200, class: "legendary", value: 2500 },
            { name: "MAXIMUM RIZZLER", rarity: "LEGENDARY", chance: 500, class: "legendary", value: 5000 },
            { name: "BUSSIN' Aura", rarity: "LEGENDARY", chance: 600, class: "legendary", value: 7500 },
            { name: "‚ú® THE ONE PIECE ‚ú®", rarity: "MYTHICAL", chance: 1000, class: "mythical", value: 15000 },
            { name: "Infinite Brain Rot", rarity: "MYTHICAL", chance: 1200, class: "mythical", value: 20000 },
            { name: "Tung Tung Shar", rarity: "DIVINE", chance: 2500, class: "divine", value: 30000 },
            { name: "DeeMeeTree", rarity: "DIVINE", chance: 2500, class: "divine", value: 35000 },
            { name: "Sigma Chad", rarity: "COSMIC", chance: 5000, class: "cosmic", value: 50000 },
            { name: "Big Back", rarity: "COSMIC", chance: 5000, class: "cosmic", value: 75000 }
        ];

        // --- LIMITED TIME AURA (LTA) LIST ---
        const limitedAuras = [
            // Rotates Mon/Tue
            { name: "Seasonal Spook", rarity: "MYTHICAL (LTD)", chance: 1500, class: "mythical", value: 30000, id: 1 }, 
            // Rotates Wed/Thu
            { name: "Holiday Hype", rarity: "DIVINE (LTD)", chance: 3000, class: "divine", value: 50000, id: 2 }, 
            // Rotates Fri/Sat/Sun
            { name: "Summer Chill", rarity: "COSMIC (LTD)", chance: 7500, class: "cosmic", value: 100000, id: 3 } 
        ];

        let activeLimitedAura = null;

        const speedUpgrades = [
            { id: 1, cost: 10000, speed: 750, label: "Fast Roll (750ms)" },
            { id: 2, cost: 50000, speed: 500, label: "Turbo Roll (500ms)" },
            { id: 3, cost: 250000, speed: 250, label: "Max Speed (250ms)" }
        ];

        // GLOBAL STATE VARIABLES
        let isRolling = false;
        let autoRollInterval = null;
        let luckMultiplier = 1;
        let rollsLeft = 0;
        let cooldowns = {};

        // Collection Tracking
        let collectedAuras = new Set();
        let inventory = []; 
        
        // Boost Button Definitions
        const boostButtons = [
            { id: 'boost-5x', mult: 5, cost: 1000, duration: 300, rolls: 10, name: '5X LUCK' },
            { id: 'boost-10x', mult: 10, cost: 5000, duration: 600, rolls: 5, name: '10X LUCK' },
            { id: 'boost-100x', mult: 100, cost: 50000, duration: 6000, rolls: 1, name: '100X LUCK' }
        ];

        // Store active cooldown timers
        let cooldownTimers = {};


        function getButton(id) {
            return document.getElementById(id);
        }

        // --- LTA ROTATION LOGIC ---
        function determineActiveLimitedAura() {
            const now = new Date();
            // Using PST time (Wednesday, Dec 10, 2025 at 3:29 PM) for calculation consistency
            const localDay = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

            if (localDay === 1 || localDay === 2) { // Monday, Tuesday
                activeLimitedAura = limitedAuras[0];
            } else if (localDay === 3 || localDay === 4) { // Wednesday, Thursday
                activeLimitedAura = limitedAuras[1];
            } else { // Friday, Saturday, Sunday (weekend special)
                activeLimitedAura = limitedAuras[2];
            }
            
            // Calculate time until midnight tonight/tomorrow morning
            const midnight = new Date(now);
            midnight.setDate(now.getDate() + 1); // Move to tomorrow
            midnight.setHours(0, 0, 0, 0); // Set time to midnight
            
            const timeUntilRotation = midnight.getTime() - now.getTime();
            
            const rotationHours = Math.floor(timeUntilRotation / (1000 * 60 * 60));
            const rotationMinutes = Math.floor((timeUntilRotation % (1000 * 60 * 60)) / (1000 * 60));

            // Update display
            const limitedDisplay = getButton('limited-aura-display');
            limitedDisplay.innerHTML = `**ACTIVE LTA:** <span class="${activeLimitedAura.class}">${activeLimitedAura.name}</span> (${activeLimitedAura.rarity}) <br> *Time Remaining: ${rotationHours}h ${rotationMinutes}m*`;
        }

        function getAurasForRolling() {
            // Include all core auras plus the currently active limited aura
            return [...auras, activeLimitedAura];
        }
        // --- END LTA ROTATION LOGIC ---


        // --- Tab Control Function ---
        function openTab(tabName, elmnt) {
            const tabcontent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove('active');
            }

            const tablinks = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            elmnt.classList.add('active');
        }

        // --- Money, Power, and Speed Persistence ---

        function calculatePowerMultiplier() {
            powerMultiplier = Math.pow(POWER_BONUS, power);
        }

        function updateMoneyDisplay() {
            getButton('money-display').textContent = money.toLocaleString();
            updateLuckDisplay(); 
            renderSpeedShop(); 
            updateRebirthDisplay(); 
        }
        
        function updatePowerDisplay() {
            getButton('power-display').textContent = power.toLocaleString();
            updateRebirthDisplay();
        }

        function loadMoney() {
            const storedMoney = localStorage.getItem(MONEY_STORAGE_KEY);
            if (storedMoney !== null) {
                money = parseInt(storedMoney);
            } else {
                money = 500;
            }
        }

        function saveMoney() {
            localStorage.setItem(MONEY_STORAGE_KEY, money.toString());
        }
        
        function loadPower() {
            const storedPower = localStorage.getItem(POWER_STORAGE_KEY);
            if (storedPower !== null) {
                power = parseInt(storedPower);
            }
            calculatePowerMultiplier();
        }
        
        function savePower() {
            localStorage.setItem(POWER_STORAGE_KEY, power.toString());
        }

        function loadSpeed() {
            const storedSpeed = localStorage.getItem(SPEED_STORAGE_KEY);
            if (storedSpeed !== null) {
                autoRollSpeed = parseInt(storedSpeed);
                
                let currentLevel = 0;
                speedUpgrades.forEach(upgrade => {
                    if (upgrade.speed === autoRollSpeed) {
                        currentLevel = upgrade.id;
                    }
                });
                speedLevel = currentLevel;
            }
        }

        function saveSpeed() {
            localStorage.setItem(SPEED_STORAGE_KEY, autoRollSpeed.toString());
        }
        // --- End Money, Power, and Speed Persistence ---


        // --- Initialization and Storage ---
        document.addEventListener('DOMContentLoaded', () => {
            loadMoney();
            loadSpeed(); 
            loadPower(); 
            updateMoneyDisplay();
            updatePowerDisplay();
            loadCollection();
            loadInventory(); 

            // Initialize cooldowns
            boostButtons.forEach(b => {
                cooldowns[b.id] = 0;
            });
            
            // LTA Setup
            determineActiveLimitedAura();

            // Render initial displays
            updateLuckDisplay();
            renderChecklist();
            updateCollectedCount();
            renderInventory(); 
            renderSpeedShop(); 
            updateRebirthDisplay(); 
            
            // Set default tab to Luck Boosts on load
            openTab('luck-shop', getButton('luck-tab'));
        });

        function loadCollection() {
            const storedCollection = localStorage.getItem(COLLECTION_STORAGE_KEY);
            if (storedCollection) {
                try {
                    const parsed = JSON.parse(storedCollection);
                    collectedAuras = new Set(parsed);
                } catch (e) {
                    collectedAuras = new Set();
                }
            }
        }

        function saveCollection() {
            localStorage.setItem(COLLECTION_STORAGE_KEY, JSON.stringify(Array.from(collectedAuras)));
        }

        function loadInventory() {
            const storedInventory = localStorage.getItem(INVENTORY_STORAGE_KEY);
            if (storedInventory) {
                try {
                    inventory = JSON.parse(storedInventory);
                } catch (e) {
                    inventory = [];
                }
            }
        }

        function saveInventory() {
            localStorage.setItem(INVENTORY_STORAGE_KEY, JSON.stringify(inventory));
        }

        function updateCollectedCount() {
            // Fixed display format
            getButton('collected-count').textContent = `${collectedAuras.size}/${auras.length + limitedAuras.length}`;
        }

        function saveAuraToCollection(auraName) {
            if (!collectedAuras.has(auraName)) {
                collectedAuras.add(auraName);
                saveCollection();
                renderChecklist();
                updateCollectedCount();
            }
        }

        function renderChecklist() {
            const listEl = getButton('uncollected-list');
            listEl.innerHTML = '';

            const allAurasForChecklist = [...auras, ...limitedAuras].sort((a, b) => b.chance - a.chance);

            allAurasForChecklist.forEach(aura => {
                const div = document.createElement('div');
                div.className = "uncollected-item";

                if (collectedAuras.has(aura.name)) {
                    div.classList.add('collected-item');
                }

                div.innerHTML = `<span class="${aura.class}">${aura.name}</span><br>${aura.rarity}`;
                listEl.appendChild(div);
            });
        }

        function renderInventory() {
             const list = getButton('inventory-list');
             list.innerHTML = '';

             // Create a combined list of all possible auras for lookup
             const allAuras = [...auras, ...limitedAuras];

             inventory.forEach(item => {
                const div = document.createElement('div');
                div.className = "inv-item";

                const fullAura = allAuras.find(a => a.name === item.name);
                const itemClass = fullAura ? fullAura.class : '';
                const itemRarity = fullAura ? fullAura.rarity : 'Unknown';

                div.innerHTML = `<strong class="${itemClass}">${item.name}</strong><br>${itemRarity}`;
                list.appendChild(div);
            });

            const sellBtn = getButton('sell-all-btn');
            sellBtn.textContent = `SELL ALL ITEMS (${inventory.length})`;
        }

        function sellAllItems() {
            if (inventory.length === 0) return;

            let totalValue = 0;
            
            inventory.forEach(item => {
                totalValue += Math.floor(item.value * powerMultiplier);
            });

            if (confirm(`Are you sure you want to sell all ${inventory.length} items for a total of üí∞${totalValue.toLocaleString()}?`)) {
                money += totalValue;
                inventory = []; 
                saveMoney();
                saveInventory();
                updateMoneyDisplay();
                renderInventory(); 
            }
        }

        function getRebirthCost() {
            return BASE_REBIRTH_COST * Math.pow(POWER_BONUS, power);
        }

        function updateRebirthDisplay() {
            const costDisplay = getButton('rebirth-cost-display');
            const rebirthBtn = getButton('rebirth-btn');
            const cost = getRebirthCost();
            
            getButton('income-mult-display').textContent = `${powerMultiplier.toFixed(1)}x`;

            if (money >= cost) {
                costDisplay.innerHTML = `You can afford the Rebirth! Get ‚ö° ${power + 1} for a total of ‚ö°${power + 1} Power.`;
                rebirthBtn.disabled = false;
                rebirthBtn.textContent = `REBIRTH NOW (Cost: üí∞${cost.toLocaleString()})`;
            } else {
                costDisplay.innerHTML = `Next Rebirth Cost: üí∞${cost.toLocaleString()} (Need üí∞${(cost - money).toLocaleString()} more)`;
                rebirthBtn.disabled = true;
                rebirthBtn.textContent = `REBIRTH NOW`;
            }
        }
        
        function doRebirth() {
            if (money < getRebirthCost()) return;
            
            if (confirm(`Are you sure you want to Rebirth? This will reset your coins, speed upgrades, and inventory, but you will gain 1 Power and permanently multiply your income by ${POWER_BONUS}x!`)) {
                
                power += 1;
                calculatePowerMultiplier();
                savePower();
                
                money = 500;
                autoRollSpeed = 1000;
                speedLevel = 0;
                inventory = [];
                
                saveMoney();
                saveSpeed();
                saveInventory();
                
                updateMoneyDisplay();
                updatePowerDisplay();
                
                alert(`SUCCESS! You are now Power ${power} with a total income multiplier of ${powerMultiplier.toFixed(1)}x!`);
            }
        }


        function resetGame() {
            if (confirm("Are you sure you want to reset ALL game progress? This cannot be undone.")) {
                localStorage.removeItem(COLLECTION_STORAGE_KEY);
                localStorage.removeItem(INVENTORY_STORAGE_KEY);
                localStorage.removeItem(MONEY_STORAGE_KEY);
                localStorage.removeItem(SPEED_STORAGE_KEY);
                localStorage.removeItem(POWER_STORAGE_KEY);

                for (const timerId in cooldownTimers) {
                    clearInterval(cooldownTimers[timerId]);
                }

                window.location.reload();
            }
        }

        // --- Auto Roll Speed Shop Functions ---

        function renderSpeedShop() {
            const shopEl = getButton('speed-upgrades');
            shopEl.innerHTML = '';
            getButton('speed-level-display').textContent = `(Level ${speedLevel}. Current: ${autoRollSpeed}ms)`;

            speedUpgrades.forEach(upgrade => {
                const btn = document.createElement('button');
                btn.className = 'upgrade-btn';
                
                const isPurchased = upgrade.id <= speedLevel;

                if (isPurchased) {
                    btn.textContent = `${upgrade.label} - PURCHASED`;
                    btn.disabled = true;
                    btn.classList.add('purchased-upgrade');
                } else {
                    btn.textContent = `${upgrade.label} - Cost: üí∞${upgrade.cost.toLocaleString()}`;
                    btn.onclick = () => buySpeedUpgrade(upgrade);
                    
                    if (money < upgrade.cost) {
                        btn.disabled = true;
                    }
                }
                shopEl.appendChild(btn);
            });
        }

        function buySpeedUpgrade(upgrade) {
            if (money >= upgrade.cost && upgrade.id === speedLevel + 1) {
                money -= upgrade.cost;
                
                speedLevel = upgrade.id;
                autoRollSpeed = upgrade.speed;

                saveMoney();
                saveSpeed(); 
                updateMoneyDisplay(); 
                
                if (autoRollInterval) {
                    toggleAutoRoll(); 
                    toggleAutoRoll();
                }
            }
        }


        // --- Rolling and Luck Functions ---

        const formatTime = (totalSeconds) => {
            if (totalSeconds < 60) return `${totalSeconds}s`;
            if (totalSeconds < 3600) {
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes}m ${seconds.toString().padStart(2, '0')}s`;
            }
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours}h ${minutes}m ${seconds.toString().padStart(2, '0')}s`;
        };

        function updateBoostButtonDisplay(id, name, cost, timeRemaining = 0, currentMultiplier) {
            const btn = getButton(id);
            if (!btn) return;

            const boost = boostButtons.find(b => b.id === id);

            if (currentMultiplier === boost.mult) {
                btn.disabled = true;
                btn.innerHTML = `BOOST ACTIVE<br>(${rollsLeft} Rolls)`;
                btn.classList.add('active-boost');
                btn.classList.remove('disabled-boost');
            }
            else if (timeRemaining > 0) {
                btn.disabled = true;
                btn.innerHTML = `COOLDOWN<br>(${formatTime(timeRemaining)})`;
                btn.classList.add('disabled-boost');
                btn.classList.remove('active-boost');
            }
            else if (money < boost.cost) {
                btn.disabled = true;
                btn.innerHTML = `${name}<br>(Cost: üí∞${boost.cost.toLocaleString()}) <span style="color:red;">(TOO POOR)</span>`;
                btn.classList.add('disabled-boost');
                btn.classList.remove('active-boost');
            }
            else {
                btn.disabled = false;
                btn.innerHTML = `${name}<br>(Cost: üí∞${boost.cost.toLocaleString()})`;
                btn.classList.remove('disabled-boost');
                btn.classList.remove('active-boost');
            }
        }

        function updateLuckDisplay() {
            const luckDisplayEl = getButton('luck-display');

            if (luckMultiplier > 1) {
                luckDisplayEl.textContent = `${luckMultiplier}x (${rollsLeft} rolls left)`;
                luckDisplayEl.className = 'luck-boost';
                if (luckMultiplier === 10) luckDisplayEl.classList.add('x10-boost');
                else if (luckMultiplier === 100) luckDisplayEl.classList.add('x100-boost');
            } else {
                luckDisplayEl.textContent = '1x';
                luckDisplayEl.className = 'luck-boost';
            }

            boostButtons.forEach(b => {
                updateBoostButtonDisplay(b.id, b.name, b.cost, cooldowns[b.id], luckMultiplier);
            });
        }

        function startCooldown(boostId, cooldownTime) {
            if (cooldownTimers[boostId]) {
                clearInterval(cooldownTimers[boostId]);
            }

            cooldowns[boostId] = cooldownTime;

            const timer = setInterval(() => {
                cooldowns[boostId]--;
                if (luckMultiplier !== boostButtons.find(b => b.id === boostId).mult) {
                    updateBoostButtonDisplay(boostId, boostButtons.find(b => b.id === boostId).name, boostButtons.find(b => b.id === boostId).cost, cooldowns[boostId], luckMultiplier);
                }

                if (cooldowns[boostId] <= 0) {
                    clearInterval(timer);
                    delete cooldownTimers[boostId];
                    cooldowns[boostId] = 0;
                    updateLuckDisplay(); 
                }
            }, 1000);

            cooldownTimers[boostId] = timer;
        }

        function activateBoost(multiplier) {
            const boost = boostButtons.find(b => b.mult === multiplier);

            if (luckMultiplier > 1 || cooldowns[boost.id] > 0) return;
            if (money < boost.cost) return;

            money -= boost.cost;
            saveMoney();
            updateMoneyDisplay(); 

            luckMultiplier = multiplier;
            rollsLeft = boost.rolls;

            startCooldown(boost.id, boost.duration);
        }

        async function rollAura(isAuto) {
            if (isRolling) return;
            isRolling = true;

            const btn = getButton('roll-btn');

            if (!isAuto) {
                btn.disabled = true;
                btn.innerText = "STEALING...";
            }

            const nameEl = getButton('aura-name');
            const rarityEl = getButton('aura-rarity');
            let ticks = 0;
            let maxTicks = 10;
            const rollMoney = 10; 

            // Grant money per roll, multiplied by powerMultiplier
            money += Math.floor(rollMoney * powerMultiplier);
            saveMoney();
            updateMoneyDisplay();

            const auraList = getAurasForRolling();

            await new Promise(resolve => {
                let interval = setInterval(() => {
                    let randomTemp = auraList[Math.floor(Math.random() * auraList.length)];
                    nameEl.innerText = randomTemp.name;
                    nameEl.className = "";
                    rarityEl.innerText = "...";
                    ticks++;

                    if (ticks >= maxTicks) {
                        clearInterval(interval);
                        resolve();
                    }
                }, 100);
            });

            finalizeRoll();

            isRolling = false;
            if (!isAuto) {
                btn.disabled = false;
                btn.innerText = "STEAL AGAIN";
            }

            // LUCK DECREMENT LOGIC
            if (luckMultiplier > 1) {
                rollsLeft--;
                if (rollsLeft <= 0) {
                    luckMultiplier = 1;
                    rollsLeft = 0;
                }
                updateLuckDisplay();
            }
        }

        function finalizeRoll() {
            let result = null;
            const currentAuraList = getAurasForRolling();

            const sortedAuras = [...currentAuraList].sort((a, b) => b.chance - a.chance);

            for (let aura of sortedAuras) {
                let threshold = (1000 / aura.chance) * luckMultiplier;

                if (Math.random() * 1000 <= threshold) {
                    result = aura;
                    break;
                }
            }

            if (!result) result = auras[0]; // Default back to Common if everything fails

            const coinGain = Math.floor(result.value * powerMultiplier);
            money += coinGain;
            saveMoney();
            updateMoneyDisplay();

            displayResult(result, coinGain);
            saveAuraToCollection(result.name);
        }

        function displayResult(item, coinGain) {
            const nameEl = getButton('aura-name');
            const rarityEl = getButton('aura-rarity');

            nameEl.innerText = item.name;
            nameEl.className = item.class;
            
            rarityEl.innerHTML = `1 in ${item.chance} ‚Ä¢ ${item.rarity}<br>+üí∞${coinGain.toLocaleString()} from steal`;

            if (item.chance >= 50) {
                document.body.classList.add("flash");
                setTimeout(() => document.body.classList.remove("flash"), 500);
            }

            addToInventory(item);
        }

        function addToInventory(item) {
            inventory.unshift({
                name: item.name,
                value: item.value
            });

            saveInventory();
            renderInventory();
        }

        function toggleAutoRoll() {
            const autoBtn = getButton('auto-roll-btn');
            const manualBtn = getButton('roll-btn');

            if (autoRollInterval) {
                clearInterval(autoRollInterval);
                autoRollInterval = null;
                autoBtn.innerText = "AUTO ROLL";
                manualBtn.disabled = false;

                const musicElement = getButton('bg-music');
                const throttleElement = getButton('throttle-preventer');
                if (musicElement) { musicElement.pause(); musicElement.currentTime = 0; }
                if (throttleElement) { throttleElement.pause(); throttleElement.currentTime = 0; }


            } else {
                manualBtn.disabled = true;
                autoBtn.innerText = "STOP AUTO ROLL";

                const musicElement = getButton('bg-music');
                const throttleElement = getButton('throttle-preventer');
                if (musicElement) musicElement.play().catch(e => console.error("Music Autoplay prevented:", e));
                if (throttleElement) throttleElement.play().catch(e => console.error("Throttle prevention failed:", e));

                autoRollInterval = setInterval(() => {
                    rollAura(true);
                }, autoRollSpeed);
            }
        }
    </script>

</body>

</html>
